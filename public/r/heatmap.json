{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "heatmap",
  "type": "registry:ui",
  "title": "Heatmap",
  "description": "A heatmap component",
  "files": [
    {
      "path": "registry/8starlabs-ui/blocks/heatmap.tsx",
      "content": "import { cn } from \"@/lib/utils\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger\n} from \"@/registry/8starlabs-ui/ui/tooltip\";\nimport { HTMLAttributes, ReactNode } from \"react\";\n\nexport type HeatmapValue = {\n  date: string; // YYYY-MM-DD\n  value: number;\n};\n\nexport type HeatmapData = HeatmapValue[];\n\ntype InterpolationModes = \"linear\" | \"sqrt\" | \"log\";\n\ntype ColorOptions =\n  | {\n      colorMode: \"discrete\";\n      colorScale?: string[];\n      customColorMap?: (\n        value: number,\n        max: number,\n        colorCount: number\n      ) => number;\n    }\n  | {\n      colorMode: \"interpolate\";\n      maxColor?: string;\n      zeroValueColor?: string;\n      interpolation?: InterpolationModes;\n    };\n\ntype HeatmapProps = HTMLAttributes<HTMLDivElement> &\n  ColorOptions & {\n    data: HeatmapData;\n    startDate: Date;\n    endDate: Date;\n    cellSize?: number;\n    gap?: number;\n    daysOfTheWeek?: \"all\" | \"MWF\" | \"none\" | \"single letter\";\n    displayStyle?: \"squares\" | \"bubbles\";\n    dateDisplayFunction?: (date: Date) => ReactNode;\n    valueDisplayFunction?: (value: number) => ReactNode;\n  };\n\nfunction getAllDays(start: Date, end: Date): Date[] {\n  // Generate all dates between start and end, inclusive\n  const days = [];\n  const curr = new Date(start);\n  while (curr <= end) {\n    days.push(new Date(curr));\n    curr.setDate(curr.getDate() + 1);\n  }\n  return days;\n}\n\nfunction padToWeekStart(days: Date[]): (Date | null)[] {\n  // Pad the beginning of the array with nulls so that the first day starts on the correct weekday\n  // eg. if the first day is a Wednesday, add three nulls for Sun, Mon, Tue\n  const firstDay = days[0].getDay(); // 0 = Sunday\n  const padding = new Array(firstDay).fill(null);\n  return [...padding, ...days];\n}\n\nfunction chunkByWeek(days: (Date | null)[]): (Date | null)[][] {\n  // Chunk the days into weeks (arrays of 7 days)\n  const weeks: (Date | null)[][] = [];\n  for (let i = 0; i < days.length; i += 7) {\n    weeks.push(days.slice(i, i + 7));\n  }\n  return weeks;\n}\n\nfunction getMonthLabel(week: (Date | null)[]) {\n  // Get the month label for the week (based on the LAST day)\n  const lastDay = week.slice().reverse().find(Boolean);\n  return lastDay ? lastDay.toLocaleString(\"default\", { month: \"short\" }) : null;\n}\n\nfunction defaultColourMap(value: number, max: number, colorCount: number) {\n  // Map value to color index\n  // default: we do a linear scale from 0 to max\n  if (colorCount <= 0) return 0; // safeguard\n  if (max <= 0 || value <= 0) return 0; // all zero values\n  const index = Math.ceil((value / max) * (colorCount - 1));\n  return Math.min(Math.max(index, 0), colorCount - 1);\n}\n\nfunction interpolateColor(\n  value: number,\n  max: number,\n  maxColor: string,\n  zeroValueColor: string,\n  scale: InterpolationModes\n): string {\n  // Interpolate color from zeroValueColor to maxColor based on value/max\n  if (value <= 0) return zeroValueColor;\n\n  let ratio = value / max;\n  switch (scale) {\n    case \"sqrt\":\n      ratio = Math.sqrt(ratio);\n      break;\n    case \"log\":\n      ratio = Math.log10(value + 1) / Math.log10(max + 1); // log scale\n      break;\n  }\n\n  const r = parseInt(maxColor.slice(1, 3), 16);\n  const g = parseInt(maxColor.slice(3, 5), 16);\n  const b = parseInt(maxColor.slice(5, 7), 16);\n\n  return `rgba(${r}, ${g}, ${b}, ${ratio})`;\n}\n\nconst defaultIntensityColours = [\n  \"#f0fdf4\", // green-50\n  \"#bbf7d0\", // green-200\n  \"#86efac\", // green-300\n  \"#22c55e\", // green-500\n  \"#166534\" // green-700\n];\n\nconst daysOfTheWeek = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\ninterface DaysOfTheWeekIndicatorProps extends HTMLAttributes<HTMLDivElement> {\n  daysOfTheWeekOption: \"all\" | \"MWF\" | \"none\" | \"single letter\";\n  cellSize: number;\n  gap: number;\n}\n\nfunction DaysOfTheWeekIndicator({\n  daysOfTheWeekOption,\n  cellSize,\n  gap,\n  style\n}: DaysOfTheWeekIndicatorProps) {\n  if (daysOfTheWeekOption === \"none\") return null;\n  const indicators = daysOfTheWeek.map((day, i) => {\n    if (daysOfTheWeekOption === \"MWF\" && ![1, 3, 5].includes(i)) {\n      return <div key={i} style={{ height: cellSize }} />;\n    }\n    return (\n      <div\n        key={i}\n        className=\"flex items-center text-muted-foreground\"\n        style={{\n          height: cellSize,\n          fontSize: cellSize,\n          lineHeight: `${cellSize}px`\n        }}\n      >\n        {daysOfTheWeekOption === \"single letter\" ? day.charAt(0) : day}\n      </div>\n    );\n  });\n  return (\n    <div className=\"flex flex-col\" style={{ ...style, gap }}>\n      {indicators}\n    </div>\n  );\n}\n\ninterface ValueIndicatorProps extends HTMLAttributes<HTMLDivElement> {\n  cellSize: number;\n  displayStyle: \"squares\" | \"bubbles\";\n  value: number; // current cell value\n  maxValue: number; // maximum possible value out of all cells\n  color: string;\n}\n\nfunction ValueIndicator({\n  cellSize,\n  displayStyle,\n  value,\n  maxValue,\n  color,\n  ...htmlProps\n}: ValueIndicatorProps) {\n  let finalSize = cellSize;\n\n  if (displayStyle === \"bubbles\") {\n    // Min bubble size = 0.3 * size, Max bubble size = size\n    const minScale = 0.3;\n    const scale = maxValue > 0 ? value / maxValue : 0;\n    finalSize = cellSize * (minScale + (1 - minScale) * scale);\n  }\n\n  return displayStyle === \"bubbles\" ? (\n    <div\n      className=\"flex items-center justify-center\"\n      style={{ width: cellSize, height: cellSize }}\n      {...htmlProps}\n    >\n      <div\n        className=\"transition-colors rounded-full\"\n        style={{ width: finalSize, height: finalSize, backgroundColor: color }}\n      />\n    </div>\n  ) : (\n    <div\n      className=\"transition-colors rounded-md\"\n      style={{\n        width: cellSize,\n        height: cellSize,\n        borderRadius: 4,\n        backgroundColor: color\n      }}\n      {...htmlProps}\n    />\n  );\n}\n\nexport default function Heatmap(props: HeatmapProps) {\n  const {\n    data,\n    startDate,\n    endDate,\n    cellSize = 20,\n    daysOfTheWeek = \"MWF\",\n    gap = 2,\n    displayStyle = \"squares\",\n    valueDisplayFunction,\n    dateDisplayFunction,\n    className,\n    colorMode,\n    ...htmlProps\n  } = props;\n\n  const valueByDate = new Map<string, number>(\n    data.map(({ date, value }) => [date, value])\n  );\n\n  const days = getAllDays(startDate, endDate);\n  const paddedDays = padToWeekStart(days);\n  const weeks = chunkByWeek(paddedDays);\n\n  const computedMax = Math.max(...data.map((d) => d.value), 1);\n\n  const monthLabels = weeks.map((week, i) => {\n    const label = getMonthLabel(week);\n    const prevLabel = i > 0 ? getMonthLabel(weeks[i - 1]) : null;\n    return label !== prevLabel ? label : null;\n  });\n\n  const getCellColor = (value: number) => {\n    if (colorMode === \"interpolate\") {\n      return interpolateColor(\n        value,\n        computedMax,\n        props.maxColor ?? \"#00ff00\",\n        props.zeroValueColor ?? \"#212735\",\n        props.interpolation ?? \"linear\"\n      );\n    } else {\n      const colorArray =\n        props.colorScale && props.colorScale.length > 0\n          ? props.colorScale\n          : defaultIntensityColours;\n\n      const map = props.customColorMap ?? defaultColourMap;\n\n      return colorArray[map(value, computedMax, colorArray.length)];\n    }\n  };\n\n  return (\n    <div\n      className={cn(\"flex\", className)}\n      style={{ gap }}\n      {...(htmlProps as HTMLAttributes<HTMLDivElement>)}\n    >\n      <DaysOfTheWeekIndicator\n        style={{ paddingTop: `${gap + 16}px` }}\n        daysOfTheWeekOption={daysOfTheWeek}\n        cellSize={cellSize}\n        gap={gap}\n      />\n\n      <div className=\"flex flex-col\" style={{ gap }}>\n        <div className=\"flex\" style={{ gap }}>\n          {weeks.map((_, i) => (\n            <div\n              key={i}\n              style={{ width: cellSize }}\n              className=\"text-xs text-muted-foreground\"\n            >\n              {monthLabels[i]}\n            </div>\n          ))}\n        </div>\n\n        <div className=\"flex\" style={{ gap }}>\n          <TooltipProvider>\n            {weeks.map((week, i) => (\n              <div key={i} className=\"flex flex-col\" style={{ gap }}>\n                {week.map((day, j) => {\n                  if (!day) {\n                    return (\n                      <div\n                        key={j}\n                        style={{ width: cellSize, height: cellSize }}\n                      />\n                    );\n                  }\n\n                  const dateKey = day.toISOString().slice(0, 10);\n                  const thisDateValue = valueByDate.get(dateKey) ?? 0;\n                  const safeValue = Math.max(0, thisDateValue);\n                  const thisColor = getCellColor(safeValue);\n\n                  return (\n                    <Tooltip key={j}>\n                      <TooltipTrigger asChild>\n                        <ValueIndicator\n                          id={`heatmap-cell-${dateKey}`}\n                          cellSize={cellSize}\n                          displayStyle={displayStyle}\n                          value={safeValue}\n                          maxValue={computedMax}\n                          color={thisColor}\n                        />\n                      </TooltipTrigger>\n                      <TooltipContent>\n                        <div className=\"text-xs\">\n                          <div>\n                            {dateDisplayFunction\n                              ? dateDisplayFunction(day)\n                              : day.toDateString()}\n                          </div>\n                          <div className=\"text-muted-foreground\">\n                            {valueDisplayFunction\n                              ? valueDisplayFunction(safeValue)\n                              : `${safeValue} event${safeValue !== 1 ? \"s\" : \"\"}`}\n                          </div>\n                        </div>\n                      </TooltipContent>\n                    </Tooltip>\n                  );\n                })}\n              </div>\n            ))}\n          </TooltipProvider>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:ui"
    }
  ]
}
